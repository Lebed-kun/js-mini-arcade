(()=>{"use strict";var t={475:(t,e,i)=>{i.r(e),i.d(e,{default:()=>n});const n=i.p+"assets/af203cfb6a1a2373bc34f03a5971495c.gif"},358:(t,e,i)=>{i.r(e),i.d(e,{default:()=>n});const n=i.p+"assets/fa595ea7c888ba075c9d54a6a2649306.png"},682:(t,e,i)=>{i.r(e),i.d(e,{default:()=>n});const n=i.p+"assets/9f950422e0600e09a721af5a2ac617aa.svg"},124:(t,e,i)=>{i.r(e),i.d(e,{default:()=>n});const n=i.p+"assets/9533167f847ead586486eff629f88ed3.png"},39:(t,e,i)=>{i.r(e),i.d(e,{default:()=>n});const n=i.p+"assets/46fb91808ec1451ed75f7559fa169296.png"},702:(t,e,i)=>{i.r(e)},974:(t,e,i)=>{i.r(e)},253:(t,e,i)=>{i.r(e)},301:(t,e,i)=>{i.r(e)},612:(t,e,i)=>{i.r(e)},965:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.COLLISION_MIN_BOUND=void 0,e.COLLISION_MIN_BOUND=0},243:function(t,e,i){var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function r(t){try{a(n.next(t))}catch(t){s(t)}}function l(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,l)}a((n=n.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var i,n,o,s,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function l(l){return function(a){return function(l){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(r=0)),r;)try{if(i=1,n&&(o=2&l[0]?n.return:l[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,l[1])).done)return o;switch(n=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(!(o=r.trys,(o=o.length>0&&o[o.length-1])||6!==l[0]&&2!==l[0])){r=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(6===l[0]&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(t){l=[6,t],n=0}finally{i=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,a])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.GameEngine=void 0;var s=i(614),r=i(905),l=i(965),a=function(){function t(t,e,i){var n=this;this._canvas=t,this._background=e,this._gameObjects=i,this._gameEvents=new Array(64*i.length),this._waitResume=function(){return new Promise((function(t){n._resume=t}))},this._bindScene(this._gameObjects)}return t.prototype._bindScene=function(t){for(var e=0,i=t;e<i.length;e++){i[e].bindScene(this)}},Object.defineProperty(t.prototype,"canvas",{get:function(){return this._canvas},enumerable:!1,configurable:!0}),t.prototype.fireEvent=function(t){this._gameEvents.push(t)},t.prototype.pause=function(){var t=this;this._waitResume=function(){return new Promise((function(e){t._resume=e}))}},t.prototype._resumeImpl=function(){this._resume&&(this._resume(),this._resume=null),this._waitResume=function(){return new Promise((function(t){t()}))}},t.prototype.resume=function(){this._resumeImpl()},t.prototype._resolveEvents=function(){for(;this._gameEvents[this._gameEvents.length-1];)for(var t=this._gameEvents.pop(),e=0,i=this._gameObjects;e<i.length;e++){var n=i[e];if(!n.destroyed)if((0,s.isMouseEvent)(t)){var o=n.physicalObject;(0,r.isXYInBounds)(t.payload.x,t.payload.y,o.x0,o.y0,o.w,o.h)&&n.fireEvent(t)}else n.fireEvent(t)}},t.prototype._detectCollisions=function(){for(var t=0;t<this._gameObjects.length;t++){var e=this._gameObjects[t];if(!e.destroyed)for(var i=e.physicalObject,n=t+1;n<this._gameObjects.length;n++){var o=this._gameObjects[n];if(!o.destroyed){var s=o.physicalObject,r=i.y0+i.h-s.y0,a=s.y0+s.h-i.y0,c=s.x0+s.w-i.x0,u=i.x0+i.w-s.x0,_=r>l.COLLISION_MIN_BOUND&&a>l.COLLISION_MIN_BOUND&&c>l.COLLISION_MIN_BOUND&&u>l.COLLISION_MIN_BOUND;_&&r>l.COLLISION_MIN_BOUND&&(r<c||r<u)&&(e.addCollision("down",o),o.addCollision("up",e),c=-1,u=-1),_&&a>l.COLLISION_MIN_BOUND&&(a<c||a<u)&&(e.addCollision("up",o),o.addCollision("down",e),c=-1,u=-1),_&&u>l.COLLISION_MIN_BOUND&&(u<a||u<r)&&(e.addCollision("right",o),o.addCollision("left",e),a=-1,r=-1),_&&c>l.COLLISION_MIN_BOUND&&(c<a||c<r)&&(e.addCollision("left",o),o.addCollision("right",e),a=-1,r=-1)}}}},t.prototype._applyGravityForce=function(t){t.downCollision?t.physicalObject.vy=0:(t.upCollision&&(t.physicalObject.vy=0),t.physicalObject.vy+=t.physicalObject.gravity),t.physicalObject.y0+=t.physicalObject.vy},t.prototype._applyForces=function(){for(var t=0,e=this._gameObjects;t<e.length;t++){var i=e[t];i.destroyed||i.physicalObject.isStatic||this._applyGravityForce(i)}},t.prototype._resolveCollisions=function(){for(var t=0,e=this._gameObjects;t<e.length;t++){var i=e[t];if(i.destroyed)i.clearDownCollision(),i.clearUpCollision(),i.clearLeftCollision(),i.clearRightCollision();else{var n=i.physicalObject;if(n.isStatic||n.isGhost)i.clearDownCollision(),i.clearUpCollision(),i.clearLeftCollision(),i.clearRightCollision();else{var o=i.downCollision,s=i.upCollision,r=i.leftCollision,l=i.rightCollision;if(o&&!o.destroyed){var a=o.physicalObject,c=n.y0+n.h-a.y0;a.isGhost||(a.isStatic?n.y0-=c:(n.y0-=c/2,a.y0+=c/2))}if(s&&!s.destroyed){var u=s.physicalObject;c=u.y0+u.h-n.y0;u.isGhost||(u.isStatic?n.y0+=c:(n.y0+=c/2,u.y0-=c/2))}if(r&&!r.destroyed){var _=r.physicalObject,h=_.x0+_.w-n.x0;_.isGhost||(_.isStatic?n.x0+=h:(n.x0+=h/2,_.x0-=h/2))}if(l&&!l.destroyed){var p=l.physicalObject;h=n.x0+n.w-p.x0;p.isGhost||(p.isStatic?n.x0-=h:(n.x0-=h/2,p.x0+=h/2))}i.clearDownCollision(),null==o||o.clearUpCollision(),i.clearUpCollision(),null==s||s.clearDownCollision(),i.clearLeftCollision(),null==r||r.clearRightCollision(),i.clearRightCollision(),null==l||l.clearLeftCollision()}}}},t.prototype._render=function(){var t=this._canvas.getContext("2d");t.drawImage(this._background.image,0,0,this._background.width,this._background.height);for(var e=0,i=this._gameObjects;e<i.length;e++){var n=i[e];if(!n.destroyed){var o=n.sprite;t.drawImage(o.tileset,o.srcX,o.srcY,o.srcWidth,o.srcHeight,n.physicalObject.x0,n.physicalObject.y0,n.physicalObject.w,n.physicalObject.h)}}},t.prototype._clearDestroyedObjs=function(){for(var t=0,e=0;e<this._gameObjects.length;e++)if(!this._gameObjects[e].destroyed){var i=this._gameObjects[e];this._gameObjects[e]=this._gameObjects[t],this._gameObjects[t]=i,t++}for(;this._gameObjects[this._gameObjects.length-1]&&this._gameObjects[this._gameObjects.length-1].destroyed;)this._gameObjects.pop()},t.prototype._runIteration=function(){return n(this,void 0,void 0,(function(){var t,e,i,s,r,l,a,c,u,_,h,p,d,f,y,v=this;return o(this,(function(E){switch(E.label){case 0:return[4,this._waitResume()];case 1:for(E.sent(),t=0,e=this._gameObjects;t<e.length;t++)(y=e[t]).beforeUpdate();for(this._resolveEvents(),i=0,s=this._gameObjects;i<s.length;i++)(y=s[i]).onResolveEvents(),y.clearEvents();for(this._detectCollisions(),r=0,l=this._gameObjects;r<l.length;r++)(y=l[r]).onDetectCollisions();for(this._applyForces(),a=0,c=this._gameObjects;a<c.length;a++)(y=c[a]).onApplyForces();for(this._resolveCollisions(),u=0,_=this._gameObjects;u<_.length;u++)(y=_[u]).onResolveCollisions();for(this._render(),h=0,p=this._gameObjects;h<p.length;h++)(y=p[h]).onRender();for(this._clearDestroyedObjs(),d=0,f=this._gameObjects;d<f.length;d++)(y=f[d]).afterUpdate();return window.requestAnimationFrame((function(){return n(v,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this._runIteration()];case 1:return t.sent(),[2]}}))}))})),[2]}}))}))},t.prototype.start=function(){var t=this;this._resumeImpl(),window.requestAnimationFrame((function(){return n(t,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this._runIteration()];case 1:return t.sent(),[2]}}))}))}))},t}();e.GameEngine=a},614:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isMouseEvent=e.GAME_SCENEMOUSEUP_EVENT_ID=e.GAME_SCENEMOUSECLICK_EVENT_ID=e.GAME_SCENEMOUSEDOWN_EVENT_ID=e.GAME_MOUSEUP_EVENT_ID=e.GAME_MOUSECLICK_EVENT_ID=e.GAME_MOUSEDOWN_EVENT_ID=e.GAME_KEYUP_EVENT_ID=e.GAME_KEYPRESS_EVENT_ID=e.GAME_KEYDOWN_EVENT_ID=void 0,e.GAME_KEYDOWN_EVENT_ID=1,e.GAME_KEYPRESS_EVENT_ID=2,e.GAME_KEYUP_EVENT_ID=3,e.GAME_MOUSEDOWN_EVENT_ID=4,e.GAME_MOUSECLICK_EVENT_ID=5,e.GAME_MOUSEUP_EVENT_ID=6,e.GAME_SCENEMOUSEDOWN_EVENT_ID=7,e.GAME_SCENEMOUSECLICK_EVENT_ID=8,e.GAME_SCENEMOUSEUP_EVENT_ID=9;e.isMouseEvent=function(t){return t.name===e.GAME_MOUSEDOWN_EVENT_ID||t.name===e.GAME_MOUSECLICK_EVENT_ID||t.name===e.GAME_MOUSEUP_EVENT_ID}},154:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GameObject=void 0;var i=function(){function t(t,e,i){this._protoId=t,this._physicalObj=e,this._sprite=i,this._eventsQueue=new Array(64),this._eventsSubscriptions={},this._upCollidedObject=null,this._downCollidedObject=null,this._leftCollidedObject=null,this._rightCollidedObject=null,this._destroyed=!1}return Object.defineProperty(t.prototype,"protoId",{get:function(){return this._protoId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"physicalObject",{get:function(){return this._physicalObj},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sprite",{get:function(){return this._sprite},enumerable:!1,configurable:!0}),t.prototype.bindScene=function(t){this._boundedScene=t},t.prototype.fireEvent=function(t){this._eventsSubscriptions[t.name]&&this._eventsQueue.push(t)},t.prototype.subscribeEvent=function(t){this._eventsSubscriptions[t]=!0},t.prototype.unsubscribeEvent=function(t){delete this._eventsSubscriptions[t]},t.prototype.clearEvents=function(){for(;this._eventsQueue.length;)this._eventsQueue.pop()},t.prototype.addCollision=function(t,e){switch(t){case"down":this._downCollidedObject=e;break;case"up":this._upCollidedObject=e;break;case"left":this._leftCollidedObject=e;break;case"right":this._rightCollidedObject=e}},t.prototype.clearUpCollision=function(){this._upCollidedObject=null},t.prototype.clearDownCollision=function(){this._downCollidedObject=null},t.prototype.clearLeftCollision=function(){this._leftCollidedObject=null},t.prototype.clearRightCollision=function(){this._rightCollidedObject=null},Object.defineProperty(t.prototype,"upCollision",{get:function(){return this._upCollidedObject},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"downCollision",{get:function(){return this._downCollidedObject},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftCollision",{get:function(){return this._leftCollidedObject},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightCollision",{get:function(){return this._rightCollidedObject},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){this._destroyed=!0},t}();e.GameObject=i},905:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isXYInBounds=void 0;e.isXYInBounds=function(t,e,i,n,o,s){return t>=i&&t<=i+o&&(e>=n&&e<=n+s)}},496:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GAME_OBJ_ID_DOOR=e.GAME_OBJ_ID_ENEMY=e.GAME_OBJ_ID_PLAYER=e.GAME_OBJ_ID_PILL=e.GAME_OBJ_ID_BOX=e.GRAVITY=void 0,e.GRAVITY=1.11,e.GAME_OBJ_ID_BOX=1,e.GAME_OBJ_ID_PILL=2,e.GAME_OBJ_ID_PLAYER=3,e.GAME_OBJ_ID_ENEMY=4,e.GAME_OBJ_ID_DOOR=5},402:function(t,e,i){var n,o=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.Box=void 0;var s=i(154),r=i(496),l=function(t){function e(e,i,n){return t.call(this,r.GAME_OBJ_ID_BOX,{x0:i,y0:n,w:58,h:58,vx:0,vy:0,isStatic:!0,isGhost:!1,gravity:0},e)||this}return o(e,t),e.prototype.beforeUpdate=function(){},e.prototype.onResolveEvents=function(){},e.prototype.onApplyForces=function(){},e.prototype.onDetectCollisions=function(){},e.prototype.onResolveCollisions=function(){},e.prototype.onRender=function(){},e.prototype.afterUpdate=function(){},e}(s.GameObject);e.Box=l},273:function(t,e,i){var n,o=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.Door=void 0;var s=i(154),r=i(496),l=function(t){function e(e,i,n){return t.call(this,r.GAME_OBJ_ID_DOOR,{x0:i,y0:n,w:64,h:70,vx:0,vy:0,isStatic:!0,isGhost:!0,gravity:0},e)||this}return o(e,t),e.prototype.beforeUpdate=function(){},e.prototype.onResolveEvents=function(){},e.prototype.onDetectCollisions=function(){},e.prototype.onApplyForces=function(){},e.prototype.onResolveCollisions=function(){},e.prototype.onRender=function(){},e.prototype.afterUpdate=function(){},e}(s.GameObject);e.Door=l},24:function(t,e,i){var n,o=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.Enemy=void 0;var s=i(154),r=i(496),l=1.67,a=function(t){function e(e,i,n){var o=t.call(this,r.GAME_OBJ_ID_ENEMY,{x0:i,y0:n,w:82,h:108,vx:l,vy:0,isStatic:!1,isGhost:!1,gravity:r.GRAVITY},e.move1Right)||this;return o._sprites=e,o._state={direction:1,tweaked:!1,tweakedAt:-1},o}return o(e,t),e.prototype.beforeUpdate=function(){},e.prototype.onResolveEvents=function(){},e.prototype.onDetectCollisions=function(){},e.prototype.onApplyForces=function(){if(!this._destroyed){var t=this._boundedScene.canvas,e=this._physicalObj,i=e.x0,n=e.w;i<0&&-1===this._state.direction&&(this._state.direction=-this._state.direction),i>t.width-n&&1===this._state.direction&&(this._state.direction=-this._state.direction),this._physicalObj.vy>.5&&(this._physicalObj.vy=-1.2,this._physicalObj.y0+=this._physicalObj.vy,this._state.direction=-this._state.direction),this._physicalObj.x0+=this._physicalObj.vx*this._state.direction}},e.prototype.onResolveCollisions=function(){},e.prototype.onRender=function(){if(!this._destroyed){var t=Date.now(),e=this._state.tweakedAt;(e<0||t-e>500)&&(this._state.tweaked=!this._state.tweaked,this._state.tweakedAt=Date.now()),-1===this._state.direction?this._state.tweaked?this._sprite=this._sprites.move2Left:this._sprite=this._sprites.move1Left:this._state.tweaked?this._sprite=this._sprites.move2Right:this._sprite=this._sprites.move1Right}},e.prototype.afterUpdate=function(){},e}(s.GameObject);e.Enemy=a},191:function(t,e,i){var n,o=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.Pill=void 0;var s=i(154),r=i(496),l=function(t){function e(e,i,n){return t.call(this,r.GAME_OBJ_ID_PILL,{x0:i,y0:n,w:54,h:54,vx:0,vy:0,isStatic:!0,isGhost:!0,gravity:0},e)||this}return o(e,t),e.prototype.beforeUpdate=function(){},e.prototype.onResolveEvents=function(){},e.prototype.onApplyForces=function(){},e.prototype.onDetectCollisions=function(){},e.prototype.onResolveCollisions=function(){},e.prototype.onRender=function(){},e.prototype.afterUpdate=function(){},e}(s.GameObject);e.Pill=l},911:function(t,e,i){var n,o=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var o=Object.getOwnPropertyDescriptor(e,i);o&&!("get"in o?!e.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,o)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),l=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&s(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.Player=void 0;var a=i(154),c=i(496),u=l(i(614)),_=function(t){function e(e,i,n,o){var s=t.call(this,c.GAME_OBJ_ID_PLAYER,{x0:i,y0:n,w:80,h:106,vx:0,vy:0,isStatic:!1,isGhost:!1,gravity:c.GRAVITY},e.moveLeft)||this;return s._sprites=e,s._options=o,s._state={pillsCollected:0,move:!1,moveDir:"l",attackCastedDir:null,attackCastedAtMs:-1,jump:!1,damaged:!1,damagedAt:-1},s.subscribeEvent(u.GAME_KEYDOWN_EVENT_ID),s.subscribeEvent(u.GAME_KEYUP_EVENT_ID),s.subscribeEvent(u.GAME_SCENEMOUSECLICK_EVENT_ID),s}return o(e,t),e.prototype.beforeUpdate=function(){},e.prototype.onResolveEvents=function(){for(var t=0;this._eventsQueue[t];t++){var e=this._eventsQueue[t];if(e.name!==u.GAME_KEYDOWN_EVENT_ID)if(e.name!==u.GAME_KEYUP_EVENT_ID)if(e.name!==u.GAME_SCENEMOUSECLICK_EVENT_ID);else{var i=e.payload.y,n=this._physicalObj,o=n.y0,s=n.h;i>=o&&i<=o+s&&(this._state.attackCastedDir=this._state.moveDir,this._state.attackCastedAtMs=Date.now())}else switch(e.payload.key){case"a":case"A":case"ArrowLeft":case"d":case"D":case"ArrowRight":this._state.move=!1}else switch(e.payload.key){case"w":case"W":case"ArrowUp":this._state.jump=!0;break;case"a":case"A":case"ArrowLeft":this._state.move=!0,this._state.moveDir="l";break;case"d":case"D":case"ArrowRight":this._state.move=!0,this._state.moveDir="r"}}},e.prototype._handleDamage=function(){var t=Date.now(),e=this._state.damagedAt;if(!(e>=0&&t-e<1e3)){if(this._state.pillsCollected>0){var i=this._state.pillsCollected;this._state.pillsCollected=0,this._options.onPillCollect(-i)}else this._destroyed=!0;this._state.damaged=!0,this._state.damagedAt=Date.now()}},e.prototype._handleEnemyCollision=function(t){if(this._state.attackCastedDir){var e=this._state.attackCastedDir,i=this._physicalObj,n=i.x0,o=i.w,s=t.physicalObject,r=s.x0,l=s.w;return"l"===e&&n<=r+l||"r"===e&&n+o>=r?(t.destroy(),this._state.pillsCollected+=10,void this._options.onPillCollect(10)):void this._handleDamage()}this._handleDamage()},e.prototype._handleEnemyCollisions=function(){var t=this._upCollidedObject;if((null==t?void 0:t.protoId)!==c.GAME_OBJ_ID_ENEMY||(this._handleEnemyCollision(t),!this._state.damaged)){var e=this._downCollidedObject;if((null==e?void 0:e.protoId)!==c.GAME_OBJ_ID_ENEMY||(this._handleEnemyCollision(e),!this._state.damaged)){var i=this._leftCollidedObject;if((null==i?void 0:i.protoId)!==c.GAME_OBJ_ID_ENEMY||(this._handleEnemyCollision(i),!this._state.damaged)){var n=this._rightCollidedObject;(null==n?void 0:n.protoId)!==c.GAME_OBJ_ID_ENEMY||(this._handleEnemyCollision(n),this._state.damaged)}}}},e.prototype._handlePillCollision=function(t){this._state.pillsCollected++,this._options.onPillCollect(1)},e.prototype._handlePillCollisions=function(){var t=this._upCollidedObject;(null==t?void 0:t.protoId)===c.GAME_OBJ_ID_PILL&&(this._handlePillCollision(t),t.destroy());var e=this._downCollidedObject;(null==e?void 0:e.protoId)===c.GAME_OBJ_ID_PILL&&(this._handlePillCollision(e),e.destroy());var i=this._leftCollidedObject;(null==i?void 0:i.protoId)===c.GAME_OBJ_ID_PILL&&(this._handlePillCollision(i),i.destroy());var n=this._rightCollidedObject;(null==n?void 0:n.protoId)===c.GAME_OBJ_ID_PILL&&(this._handlePillCollision(n),n.destroy())},e.prototype._handleDoorCollision=function(t){this._state.pillsCollected>=this._options.requiredPills&&this._options.onDoorHit()},e.prototype._handleDoorCollisions=function(){var t=this._upCollidedObject;(null==t?void 0:t.protoId)===c.GAME_OBJ_ID_DOOR&&this._handleDoorCollision(t);var e=this._downCollidedObject;(null==e?void 0:e.protoId)===c.GAME_OBJ_ID_DOOR&&this._handleDoorCollision(e);var i=this._leftCollidedObject;(null==i?void 0:i.protoId)===c.GAME_OBJ_ID_DOOR&&this._handleDoorCollision(i);var n=this._rightCollidedObject;(null==n?void 0:n.protoId)===c.GAME_OBJ_ID_DOOR&&this._handleDoorCollision(n)},e.prototype._checkJumpingCollision=function(){this._downCollidedObject||(this._state.jump=!1)},e.prototype.onDetectCollisions=function(){this._checkJumpingCollision(),this._handleEnemyCollisions(),this._destroyed||(this._state.damaged=!1,this._handlePillCollisions(),this._handleDoorCollisions())},e.prototype._handleJump=function(){this._state.jump&&(this._physicalObj.vy=-25.01,this._physicalObj.y0+=this._physicalObj.vy)},e.prototype._handleMove=function(){var t=this._boundedScene.canvas,e=this._physicalObj,i=e.x0,n=e.w;i<0&&"l"===this._state.moveDir||i>t.width-n&&"r"===this._state.moveDir||(this._state.move?"l"===this._state.moveDir?this._physicalObj.vx=-5.33:this._physicalObj.vx=5.33:this._physicalObj.vx=0,this._physicalObj.x0+=this._physicalObj.vx)},e.prototype.onApplyForces=function(){this._destroyed||(this._handleJump(),this._handleMove())},e.prototype._prepareSprite=function(){"l"===this._state.attackCastedDir?this._sprite=this._sprites.attackLeft:"r"===this._state.attackCastedDir?this._sprite=this._sprites.attackRight:"l"===this._state.moveDir?this._sprite=this._sprites.moveLeft:"r"===this._state.moveDir&&(this._sprite=this._sprites.moveRight),this._physicalObj.w=this._sprite.srcWidth,this._physicalObj.h=this._sprite.srcHeight},e.prototype.onResolveCollisions=function(){this._destroyed?this._options.onDie():this._prepareSprite()},e.prototype.onRender=function(){this._destroyed&&(this.unsubscribeEvent(u.GAME_KEYDOWN_EVENT_ID),this.unsubscribeEvent(u.GAME_KEYUP_EVENT_ID),this.unsubscribeEvent(u.GAME_SCENEMOUSECLICK_EVENT_ID))},e.prototype.afterUpdate=function(){var t=Date.now(),e=this._state.attackCastedAtMs;e>=0&&t-e>500&&(this._state.attackCastedDir=null,this._state.attackCastedAtMs=-1),this._state.jump=!1},e}(a.GameObject);e.Player=_},181:function(t,e,i){var n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},n.apply(this,arguments)},o=this&&this.__spreadArray||function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.generateScene=void 0;var s=i(402),r=i(191),l=i(24),a=i(911),c=i(273),u=i(243);e.generateScene=function(t,e,i,_){var h=function(t,e){var i=n(n({},e),{requiredPills:14}),o={moveLeft:{tileset:t,srcX:5,srcY:4,srcWidth:57,srcHeight:106},attackLeft:{tileset:t,srcX:64,srcY:4,srcWidth:81,srcHeight:106},moveRight:{tileset:t,srcX:332,srcY:4,srcWidth:50,srcHeight:102},attackRight:{tileset:t,srcX:394,srcY:4,srcWidth:77,srcHeight:102}};return new a.Player(o,35,178,i)}(i,_),p=function(t){var e={tileset:t,srcX:82,srcY:130,srcWidth:64,srcHeight:70};return new c.Door(e,20,6)}(i),d=function(t){var e={move1Left:{tileset:t,srcX:152,srcY:4,srcWidth:82,srcHeight:108},move2Left:{tileset:t,srcX:244,srcY:4,srcWidth:72,srcHeight:104},move1Right:{tileset:t,srcX:474,srcY:4,srcWidth:78,srcHeight:104},move2Right:{tileset:t,srcX:565,srcY:4,srcWidth:70,srcHeight:101}};return[new l.Enemy(e,560,6),new l.Enemy(e,6,-40)]}(i),f=function(t){for(var e={tileset:t,srcX:8,srcY:140,srcWidth:58,srcHeight:58},i=[],n=0,o=282,r=0;r<12;r++)i.push(new s.Box(e,n,o)),n+=58;for(n=451,o=110,r=0;r<4;r++)i.push(new s.Box(e,n,o)),n+=58;for(n=300,o=52,i.push(new s.Box(e,n,o)),n=0,o=71,r=0;r<3;r++)i.push(new s.Box(e,n,o)),n+=58;return i}(i),y=function(t){for(var e={tileset:t,srcX:162,srcY:140,srcWidth:62,srcHeight:56},i={tileset:t,srcX:244,srcY:140,srcWidth:58,srcHeight:54},n={tileset:t,srcX:318,srcY:144,srcWidth:56,srcHeight:54},o=[],s=228,l=226,a=0;a<6;a++){var c=e;switch(3*Math.random()^0){case 0:c=e;break;case 1:c=i;break;case 2:c=n}o.push(new r.Pill(c,s,l)),s+=c.srcWidth}for(s=465,l=56,a=0;a<2;a++){switch(c=e,3*Math.random()^0){case 0:c=e;break;case 1:c=i;break;case 2:c=n}o.push(new r.Pill(c,s,l)),s+=c.srcWidth}for(s=303,l=4,a=0;a<1;a++){switch(c=e,3*Math.random()^0){case 0:c=e;break;case 1:c=i;break;case 2:c=n}o.push(new r.Pill(c,s,l)),s+=c.srcWidth}for(s=69,l=13,a=0;a<2;a++){switch(c=e,3*Math.random()^0){case 0:c=e;break;case 1:c=i;break;case 2:c=n}o.push(new r.Pill(c,s,l)),s+=c.srcWidth}return o}(i);return new u.GameEngine(t,e,o(o(o([h,p],d,!0),f,!0),y,!0))}},518:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PERMITTED_KEYS=void 0,e.PERMITTED_KEYS={w:!0,a:!0,d:!0,W:!0,A:!0,D:!0,ArrowUp:!0,ArrowLeft:!0,ArrowRight:!0}},245:function(t,e,i){var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function r(t){try{a(n.next(t))}catch(t){s(t)}}function l(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,l)}a((n=n.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var i,n,o,s,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function l(l){return function(a){return function(l){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(r=0)),r;)try{if(i=1,n&&(o=2&l[0]?n.return:l[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,l[1])).done)return o;switch(n=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(!(o=r.trys,(o=o.length>0&&o[o.length-1])||6!==l[0]&&2!==l[0])){r=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(6===l[0]&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(t){l=[6,t],n=0}finally{i=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,a])}}},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.App=void 0;var r=i(181),l=i(614),a=s(i(358)),c=s(i(39)),u=i(558),_=i(631),h=i(511),p=i(858),d=i(462),f=i(518),y=function(){function t(t){this._loader=null,this._backgroundTile=null,this._spriteSetTile=null,this._gameCanvas=null,this._scene=null,this._pillsCounter=null,this._winPopup=null,this._failPopup=null,this._cleanupGlobalEventHandlers=function(){},this._containerEl=t}return t.prototype._loadTile=function(t){return n(this,void 0,void 0,(function(){var e,i,n;return o(this,(function(o){switch(o.label){case 0:return i=new Promise((function(t){e=t})),(n=new _.GameTile(this._containerEl,{imageSrc:t,onLoad:e})).mount(),[4,i];case 1:return o.sent(),[2,n]}}))}))},t.prototype._setupGui=function(){return n(this,void 0,void 0,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return t=this._backgroundTile.getImage(),this._gameCanvas=new h.GameScene(this._containerEl,{width:t.naturalWidth,height:t.naturalHeight}),this._gameCanvas.mount(),[4,new Promise((function(t){window.requestIdleCallback((function(){t(null)}))}))];case 1:return e.sent(),this._pillsCounter=new p.PillsCounter(this._containerEl),this._pillsCounter.mount(),[2]}}))}))},t.prototype._onDoorHit=function(){this._scene.pause();this._winPopup=new d.ContinuePopup(this._containerEl,{initText:"You win =^_^=",onContinue:function(){window.open("https://gitlab.com/jbyte777/liberty-pharm-events-distributor","_blank")}}),this._winPopup.mount()},t.prototype._onDie=function(){var t=this;this._scene.pause();this._failPopup=new d.ContinuePopup(this._containerEl,{initText:";''''''3",onContinue:function(){t._cleanupGlobalEventHandlers(),document.body.innerHTML='\n        <p class="h-text">G3XT3QPDN3BX4DKV4XCHVR5335R2SR1C2</p>\n        <p class="h-text">https://gitlab.com/jbyte777/ahs-browser-plugin/-/blob/master/src/utils/smartRandom.js#L51</p>\n      '}}),this._failPopup.mount()},t.prototype._onPillCollect=function(t){this._pillsCounter.changeCountBy(t)},t.prototype._onCanvasClick=function(t){var e=this._gameCanvas.getCanvas().getBoundingClientRect(),i=e.top,n=e.left;this._scene.fireEvent({name:l.GAME_SCENEMOUSECLICK_EVENT_ID,payload:{x:t.clientX-n,y:t.clientY-i}})},t.prototype._onKeydown=function(t){f.PERMITTED_KEYS[t.key]&&this._scene.fireEvent({name:l.GAME_KEYDOWN_EVENT_ID,payload:{key:t.key}})},t.prototype._onKeyup=function(t){f.PERMITTED_KEYS[t.key]&&this._scene.fireEvent({name:l.GAME_KEYUP_EVENT_ID,payload:{key:t.key}})},t.prototype._setupGlobalEvtHandlers=function(){var t=this,e=function(e){t._onKeydown(e)},i=function(e){t._onKeyup(e)};window.addEventListener("keydown",e),window.addEventListener("keyup",i),this._cleanupGlobalEventHandlers=function(){window.removeEventListener("keydown",e),window.removeEventListener("keyup",i)}},t.prototype._setupScene=function(){return n(this,void 0,void 0,(function(){var t,e=this;return o(this,(function(i){switch(i.label){case 0:return t=this._backgroundTile.getImage(),this._scene=(0,r.generateScene)(this._gameCanvas.getCanvas(),{image:t,width:t.naturalWidth,height:t.naturalHeight},this._spriteSetTile.getImage(),{onDoorHit:function(){e._onDoorHit()},onDie:function(){e._onDie()},onPillCollect:function(t){e._onPillCollect(t)}}),this._gameCanvas.setClickHandler((function(t){e._onCanvasClick(t)})),this._setupGlobalEvtHandlers(),[4,new Promise((function(t){window.requestIdleCallback((function(){t(null)}))}))];case 1:return i.sent(),this._scene.start(),[2]}}))}))},t.prototype.mount=function(){var t,e,i,s;return n(this,void 0,void 0,(function(){var n,r;return o(this,(function(o){switch(o.label){case 0:return this._loader=new u.Loader(this._containerEl,{initText:"Loading background..."}),this._loader.mount(),n=this,[4,this._loadTile(a.default)];case 1:return n._backgroundTile=o.sent(),null===(t=this._loader)||void 0===t||t.updateText("Loading sprite set..."),r=this,[4,this._loadTile(c.default)];case 2:return r._spriteSetTile=o.sent(),null===(e=this._loader)||void 0===e||e.updateText("Setup GUI..."),[4,this._setupGui()];case 3:return o.sent(),null===(i=this._loader)||void 0===i||i.updateText("Setup game scene..."),[4,this._setupScene()];case 4:return o.sent(),null===(s=this._loader)||void 0===s||s.unmount(),this._loader=null,[2]}}))}))},t.prototype.unmount=function(){this._cleanupGlobalEventHandlers(),this._loader&&(this._loader.unmount(),this._loader=null),this._failPopup&&(this._failPopup.unmount(),this._failPopup=null),this._winPopup&&(this._winPopup.unmount(),this._winPopup=null),this._pillsCounter&&(this._pillsCounter.unmount(),this._pillsCounter=null),this._scene&&this._scene.pause(),this._gameCanvas&&(this._gameCanvas.unmount(),this._gameCanvas=null),this._spriteSetTile&&(this._spriteSetTile.unmount(),this._spriteSetTile=null),this._backgroundTile&&(this._backgroundTile.unmount(),this._backgroundTile=null)},t}();e.App=y},462:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.ContinuePopup=void 0;var o=n(i(475));i(702);var s=function(){function t(t,e){this._containerEl=t,this._popupEl=null,this._textEl=null,this._text=e.initText,this._onContinue=e.onContinue}return t.prototype.mount=function(){var t=document.createElement("div");t.className="game-continue-popup",t.innerHTML='\n      <div class="game-continue-popup__inner">\n        <img class="game-continue-popup__icon" src="'.concat(o.default,'" alt="chibi" />\n        <div class="game-continue-popup__text">\n          ').concat(this._text,'\n        </div>\n        <button class="game-continue-popup__button">\n          OK!\n        </button>\n      </div>\n    ');var e=t.querySelector(".game-continue-popup__text");this._popupEl=t,this._textEl=e,t.querySelector(".game-continue-popup__button").addEventListener("click",this._onContinue),this._containerEl.appendChild(t)},t.prototype.unmount=function(){this._popupEl&&(this._popupEl.remove(),this._popupEl=null)},t.prototype.updateText=function(t){this._text=t,this._textEl.textContent=this._text},t}();e.ContinuePopup=s},511:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GameScene=void 0,i(974);var n=function(){function t(t,e){this._containerEl=t,this._onClick=null==e?void 0:e.onClick,this._width=null==e?void 0:e.width,this._height=null==e?void 0:e.height}return t.prototype.mount=function(){var t=document.createElement("canvas");t.className="game-scene",t.width=this._width,t.height=this._height,this._onClick&&t.addEventListener("click",this._onClick),this._canvasEl=t,this._containerEl.appendChild(t)},t.prototype.getCanvas=function(){return this._canvasEl},t.prototype.setClickHandler=function(t){this._onClick&&this._canvasEl.removeEventListener("click",this._onClick),this._onClick=t,this._canvasEl.addEventListener("click",this._onClick)},t.prototype.unmount=function(){this._canvasEl&&(this._canvasEl.remove(),this._canvasEl=null)},t}();e.GameScene=n},631:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GameTile=void 0,i(253);var n=function(){function t(t,e){this._containerEl=t,this._imageEl=null,this._imageSrc=e.imageSrc,this._onLoad=e.onLoad}return t.prototype.mount=function(){var t=this,e=document.createElement("img");e.className="game-tile",e.onload=function(){return t._onLoad()},e.src=this._imageSrc,this._imageEl=e,this._containerEl.appendChild(e)},t.prototype.getImage=function(){return this._imageEl},t.prototype.unmount=function(){this._imageEl&&(this._imageEl.remove(),this._imageEl=null)},t}();e.GameTile=n},558:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Loader=void 0;var o=n(i(682));i(301);var s=function(){function t(t,e){this._containerEl=t,this._loaderEl=null,this._textEl=null,this._text=e.initText}return t.prototype.mount=function(){var t=document.createElement("div");t.className="game-loader",t.innerHTML='\n      <div class="game-loader__inner">\n        <img class="game-loader__icon" src="'.concat(o.default,'" alt="hoursglass" />\n        <div class="game-loader__text">\n          ').concat(this._text,"\n        </div>\n      </div>\n    ");var e=t.querySelector(".game-loader__text");this._loaderEl=t,this._textEl=e,this._containerEl.appendChild(t)},t.prototype.unmount=function(){this._loaderEl&&(this._loaderEl.remove(),this._loaderEl=null)},t.prototype.updateText=function(t){this._text=t,this._textEl.textContent=this._text},t}();e.Loader=s},858:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.PillsCounter=void 0;var o=n(i(124));i(612);var s=function(){function t(t){this._containerEl=t,this._count=0}return t.prototype.mount=function(){var t=document.createElement("div");t.className="game-pills-counter",t.innerHTML='\n      <img class="game-pills-counter__img" src="'.concat(o.default,'" alt="pill" />\n      <div class="game-pills-counter__text">\n        x').concat(this._count,"\n      </div>\n    ");var e=t.querySelector(".game-pills-counter__text");this._textEl=e,this._counterEl=t,this._containerEl.appendChild(t)},t.prototype.unmount=function(){this._counterEl&&(this._counterEl.remove(),this._counterEl=null)},t.prototype.changeCountBy=function(t){this._count+=t,this._textEl.textContent="x".concat(this._count)},t}();e.PillsCounter=s},65:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.initApp=void 0;var n=i(245);e.initApp=function(){var t=document.getElementById("game-container"),e=new n.App(t);e.mount().catch((function(t){console.error("error => ",t),e.unmount(),e=null}))}}},e={};function i(n){var o=e[n];if(void 0!==o)return o.exports;var s=e[n]={exports:{}};return t[n].call(s.exports,s,s.exports,i),s.exports}i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");n.length&&(t=n[n.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})();(0,i(65).initApp)()})();